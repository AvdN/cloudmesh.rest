\section{CMD5}\label{cmd5}

CMD is a very useful package in python to create command line shells.
However it does not allow the dynamic integration of newly defined
commands. Furthermore, addition to cmd need to be done within the same
source tree. To simplify developping commands by a number of people and
to have a dynamic plugin mechnism, we developed cmd5. It is a rewrite on
our ealier effords in cloudmesh and cmd3.

\subsection{Resources}\label{resources}

The source code for cmd5 is located in github:

\begin{itemize}
\tightlist
\item
  \url{https://github.com/cloudmesh/cmd5}
\end{itemize}

Installation from source -----------------------

We recommend that you use a virtualenv either with virtualenv or pyenv.
This can be either achieved vor virtualenv with:

\begin{verbatim}
virtualenv ~/ENV2
\end{verbatim}

or for pyenv, with:

\begin{verbatim}
pyenev virtualenv 2.7.13 ENV2
\end{verbatim}

Now you need to get two source directories. We assume yo place them in
\textasciitilde{}/github:

\begin{verbatim}
mkdir ~/github
cd ~/github

git clone https://github.com/cloudmesh/common.git
git clone https://github.com/cloudmesh/cmd5.git
git clone https://github.com/cloudmesh/extbar.git

cd ~/github/common
python setup.py install
pip install .

cd ~/github/cmd5
python setup.py install
pip install .

cd ~/github/extbar
python setup.py install
pip install .
\end{verbatim}

The cmd5 repository contains the shell, while the extbar directory
contains the sample to add the dynamic commands foo and bar.

\subsection{Execution}\label{execution}

To run the shell you can activate it with the cms command. cms stands
for cloudmesh shell:

\begin{verbatim}
(ENV2) $ cms
\end{verbatim}

It will print the banner and enter the shell:

\begin{verbatim}
+-------------------------------------------------------+
|   ____ _                 _                     _      |
|  / ___| | ___  _   _  __| |_ __ ___   ___  ___| |__   |
| | |   | |/ _ \| | | |/ _` | '_ ` _ \ / _ \/ __| '_ \  |
| | |___| | (_) | |_| | (_| | | | | | |  __/\__ \ | | | |
|  \____|_|\___/ \__,_|\__,_|_| |_| |_|\___||___/_| |_| |
+-------------------------------------------------------+
|                  Cloudmesh CMD5 Shell                 |
+-------------------------------------------------------+

cms>
\end{verbatim}

To see the list of commands you can say

\begin{quote}
cms\textgreater{} help
\end{quote}

To see the manula page for a specific command, please use:

\begin{verbatim}
help COMMANDNAME
\end{verbatim}

\subsection{Create your own Extension}\label{create-your-own-extension}

One of the most important features of CMD5 is its ability to extend it
with new commands. This is done via packaged name spaces. This is
defined in the setup.py file of your enhancement. The best way to create
an enhancement is to take a look at the code in

\begin{itemize}
\tightlist
\item
  \url{https://github.com/cloudmesh/extbar.git}
\end{itemize}

Simply copy the code and modify the bar and foo commands to fit yor
needs.

\begin{description}
\item[make sure you are not copying the .git directory. Thus we]
recommend that you copy it explicitly file by file or directory by
directory
\end{description}

It is important that all objects are defined in the command itself and
that no global variables be use in order to allow each shell command to
stand alone. Naturally you should develop API libraries outside of the
cloudmesh shell command and reuse them in order to keep the command code
as small as possible. We place the command in:

\begin{verbatim}
cloudmsesh/ext/command/COMMANDNAME.py
\end{verbatim}

An example for the bar command is presented at:

\begin{itemize}
\tightlist
\item
  \url{https://github.com/cloudmesh/extbar/blob/master/cloudmesh/ext/command/bar.py}
\end{itemize}

It shows how simple the command definition is (bar.py):

\begin{verbatim}
from __future__ import print_function
from cloudmesh.shell.command import command
from cloudmesh.shell.command import PluginCommand

class BarCommand(PluginCommand):

    @command
    def do_bar(self, args, arguments):
        """
        ::
          Usage:
                command -f FILE
                command FILE
                command list
          This command does some useful things.
          Arguments:
              FILE   a file name
          Options:
              -f      specify the file
        """
        print(arguments)
\end{verbatim}

An important difference to other CMD solutions is that our commands can
leverage (besides the standrad definition), docopts as a way to define
the manual page. This allows us to use arguments as dict and use simple
if conditions to interpret the command. Using docopts has the advantage
that contributors are forced to think about the command and its options
and document them from the start. Previously we used not to use docopts
and argparse was used. However we noticed that for some contributions
the lead to commands that were either not properly documented or the
developers delivered ambiguous commands that resulted in confusion and
wrong ussage by the users. Hence, we do recommend that you use docopts.

The transformation is enabled by the @command decorator that takes also
the manual page and creates a proper help message for the shell
automatically. Thus there is no need to introduce a sepaarte help method
as would normally be needed in CMD.

\subsection{Excersise}\label{excersise}

\begin{description}
\item[CMD5.1:]
Install cmd5 on your computer.
\item[CMD5.2:]
Write a new command with your firstname as the command name.
\item[CMD5.3:]
Write a new command and experiment with docopt syntax and argument
interpretation of the dict with if conditions.
\item[CMD5.4:]
If you have useful extensions that you like us to add by default, please
work with us.
\end{description}
